@model Trouvaille.Server.Models.Places.AddPlaceViewModel

@{
    ViewBag.Title = "Create";
}

<div class="row">
    <div id="map" class="col-md-6" style="position: relative; width: 400px; height: 400px;"></div>
    <div class="col-md-6">
        @using (Html.BeginForm("CreatePlace", "Profile", FormMethod.Post, new { }))
        {
            @Html.AntiForgeryToken()
            <div class="form-horizontal">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                <div class="form-group">
                    @Html.LabelFor(model => model.Address, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Address, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Address, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.CountryId, "Country", htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.DropDownListFor(model => model.CountryId, new SelectList(Model.Countries, "Id", "Name"), htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.CountryId, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.TextAreaFor(model => model.Description, new { @class = "md-textarea" })
                        @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.HiddenFor(model => model.Longtitude, new { htmlAttributes = new { id = "long" } })
                </div>
                <div class="form-group">
                    @Html.HiddenFor(model => model.Latitude, new { htmlAttributes = new { id = "lat" } })
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" value="Create" class="btn stormy-color" />
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0"></script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDrFFeTMMLaOj49X29A_qeVbsMDs97rAfQ&callback=initMap">
</script>
<script type="text/javascript">
    var map;
    var marker;
    var infowindow;
    var messagewindow;

    function initMap() {
        var uluru = { lat: 42.6977, lng: 23.3219 };
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 4,
            center: uluru
        });

        var marker = new google.maps.Marker({
            position: uluru,
            map: map
        });

        $("#Latitude").val(marker.getPosition().lat());
        $("#Longtitude").val(marker.getPosition().lng());

        infowindow = new google.maps.InfoWindow({
            content: document.getElementById('form')
        });

        messagewindow = new google.maps.InfoWindow({
            content: document.getElementById('message')
        });

        google.maps.event.addListener(map, 'click', function (event) {
            marker.setMap(null);
            marker = new google.maps.Marker({
                position: event.latLng,
                map: map
            });

            $("#Latitude").val(marker.getPosition().lat());
            $("#Longtitude").val(marker.getPosition().lng());

            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });
        });
    }
</script>
